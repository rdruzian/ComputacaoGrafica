<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

        <title>Babylon.js sample code</title>

        <!-- Babylon.js -->
        <script src="https://code.jquery.com/pep/0.4.2/pep.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/ammo.js"></script>
        <script src="https://preview.babylonjs.com/cannon.js"></script>
        <script src="https://preview.babylonjs.com/Oimo.js"></script>
        <script src="https://preview.babylonjs.com/earcut.min.js"></script>
        <script src="https://preview.babylonjs.com/babylon.js"></script>
        <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
        <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
        <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
        <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
        <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
        <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
        <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

        <style>
            html, body {
                overflow: hidden;
                width: 100%;
                height: 100%;
                margin: 0;
                padding: 0;
            }

            #renderCanvas {
                width: 100%;
                height: 100%;
                touch-action: none;
            }
        </style>
    </head>
    <body>
        <canvas id="renderCanvas"></canvas>
        <script>
            var canvas = document.getElementById("renderCanvas");
            var engine = null;
            var scene = null;
            var sceneToRender = null;
            var createDefaultEngine = function() { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true,  disableWebGL2Support: false}); };
            var notes = new Map();
            var createScene = function () {
                scene = new BABYLON.Scene(engine);
                const camera = new BABYLON.ArcRotateCamera("Camera", -Math.PI / 2, Math.PI / 4, 10, BABYLON.Vector3(0, 0, 0));
                camera.attachControl(canvas, true);
                const light1 = new BABYLON.DirectionalLight("DirectionalLight", new BABYLON.Vector3(0, -1, 1));
                const light2 = new BABYLON.HemisphericLight("HemiLight", new BABYLON.Vector3(0, 1, 0));
                light1.intensity =0.75;
                light2.intensity =0.5;
                managerEvents();

                for(i=0; i<15; i++)
                    white(i);

                for(i=0; i<10; i++)
                    black(i);

                function white(x){
                    switch(x){
                        case 0:
                            doh = new TocaNota("do", "http://localhost:5500/assets/Notas/do.aiff");
                            doh.box.size = 1;
                            doh.box.width = 0.3; 
                            doh.box.height = 0.1; 
                            doh.box.depth = 1;
                            doh.box.position.x = (x*0.3) + (x/100);
                            notes.set("do", doh);
                        case 7:
                            doh1 = new TocaNota("do1", "http://localhost:5500/assets/Notas/do.aiff");
                            doh1.box.size = 1;
                            doh1.box.width = 0.3; 
                            doh1.box.height = 0.1; 
                            doh1.box.depth = 1;
                            doh1.box.position.x = (x*0.3) + (x/100);
                            notes.set("do1", doh1);
                        case 14:
                            doh2 = new TocaNota("do2", "http://localhost:5500/assets/Notas/do.aiff");
                            doh2.box.size = 1;
                            doh2.box.width = 0.3; 
                            doh2.box.height = 0.1; 
                            doh2.box.depth = 1;
                            doh2.box.position.x = (x*0.3) + (x/100);
                            notes.set("do2", doh2);
                        case 1:
                            re = new TocaNota("re", "http://localhost:5500/assets/Notas/re.aiff");
                            re.box.size = 1;
                            re.box.width = 0.3; 
                            re.box.height = 0.1; 
                            re.box.depth = 1;
                            re.box.position.x = (x*0.3) + (x/100);
                            notes.set("re", re);
                        case 8:
                            re1 = new TocaNota("re1", "http://localhost:5500/assets/Notas/re.aiff");
                            re1.box.size = 1;
                            re1.box.width = 0.3; 
                            re1.box.height = 0.1; 
                            re1.box.depth = 1;
                            re1.box.position.x = (x*0.3) + (x/100);
                            notes.set("re1", re1);
                        case 2:
                            mi = new TocaNota("mi", "http://localhost:5500/assets/Notas/mi.aiff");
                            mi.box.size = 1;
                            mi.box.width = 0.3; 
                            mi.box.height = 0.1; 
                            mi.box.depth = 1;
                            mi.box.position.x = (x*0.3) + (x/100);
                            notes.set("mi", mi);
                        case 9:
                            mi1 = new TocaNota("mi1", "http://localhost:5500/assets/Notas/mi.aiff");
                            mi1.box.size = 1;
                            mi1.box.width = 0.3; 
                            mi1.box.height = 0.1; 
                            mi1.box.depth = 1;
                            mi1.box.position.x = (x*0.3) + (x/100);
                            notes.set("mi1", mi1);
                        case 3:
                            fa = new TocaNota("fa", "http://localhost:5500/assets/Notas/fa.aiff");
                            fa.box.size = 1;
                            fa.box.width = 0.3; 
                            fa.box.height = 0.1; 
                            fa.box.depth = 1;
                            fa.box.position.x = (x*0.3) + (x/100);
                            notes.set("fa", fa);
                        case 10:
                            fa1 = new TocaNota("fa1", "http://localhost:5500/assets/Notas/fa.aiff");
                            fa1.box.size = 1;
                            fa1.box.width = 0.3; 
                            fa1.box.height = 0.1; 
                            fa1.box.depth = 1;
                            fa1.box.position.x = (x*0.3) + (x/100);
                            notes.set("fa1", fa1);
                        case 4:
                            sol = new TocaNota("sol", "http://localhost:5500/assets/Notas/sol.aiff");
                            sol.box.size = 1;
                            sol.box.width = 0.3; 
                            sol.box.height = 0.1; 
                            sol.box.depth = 1;
                            sol.box.position.x = (x*0.3) + (x/100);
                            notes.set("sol", sol);
                        case 11:
                            sol1 = new TocaNota("sol1", "http://localhost:5500/assets/Notas/sol.aiff");
                            sol1.box.size = 1;
                            sol1.box.width = 0.3; 
                            sol1.box.height = 0.1; 
                            sol1.box.depth = 1;
                            sol1.box.position.x = (x*0.3) + (x/100);
                            notes.set("sol1", sol1);
                        case 5:
                            la = new TocaNota("la", "http://localhost:5500/assets/Notas/la.aiff");
                            la.box.size = 1;
                            la.box.width = 0.3; 
                            la.box.height = 0.1; 
                            la.box.depth = 1;
                            la.box.position.x = (x*0.3) + (x/100);
                            notes.set("la", la);
                        case 12:
                            la1 = new TocaNota("la1", "http://localhost:5500/assets/Notas/la.aiff");
                            la1.box.size = 1;
                            la1.box.width = 0.3; 
                            la1.box.height = 0.1; 
                            la1.box.depth = 1;
                            la1.box.position.x = (x*0.3) + (x/100);
                            notes.set("la1", la1);
                        case 6:
                            si = new TocaNota("si", "http://localhost:5500/assets/Notas/si.aiff");
                            si.box.size = 1;
                            si.box.width = 0.3; 
                            si.box.height = 0.1; 
                            si.box.depth = 1;
                            si.box.position.x = (x*0.3) + (x/100);
                            notes.set("si", si);
                        case 13:
                            si1 = new TocaNota("si1", "http://localhost:5500/assets/Notas/si.aiff");
                            si1.box.size = 1;
                            si1.box.width = 0.3; 
                            si1.box.height = 0.1; 
                            si1.box.depth = 1;
                            si1.box.position.x = (x*0.3) + (x/100);
                            notes.set("si1", si1);
                    }
                }
                function black(i){
                    switch(i){
                        case 0:
                            reb = new TocaNota("reb", "http://localhost:5500/assets/Notas/reb.aiff");
                            reb.box.size = 1;
                            reb.box.width = 0.15; 
                            reb.box.height = 0.1; 
                            reb.box.depth = 0.65;
                            reb.box.position.y = 0.06;
                            reb.box.position.z = 0.15;
                            reb.box.position.x = 0.16;
                            notes.set("reb", reb);
                        case 1:
                            mib = new TocaNota("mib", "http://localhost:5500/assets/Notas/mib.aiff");
                            mib.box.size = 1;
                            mib.box.width = 0.15; 
                            mib.box.height = 0.1; 
                            mib.box.depth = 0.65;
                            mib.box.position.y = 0.06;
                            mib.box.position.z = 0.15;
                            mib.box.position.x = 0.49;
                            notes.set("mib", mib);
                        case 2:
                            solb = new TocaNota("solb", "http://localhost:5500/assets/Notas/solb.aiff");
                            solb.box.size = 1;
                            solb.box.width = 0.15; 
                            solb.box.height = 0.1; 
                            solb.box.depth = 0.65;
                            solb.box.position.y = 0.06;
                            solb.box.position.z = 0.15;
                            solb.box.position.x = 1.07;
                            notes.set("solb", solb);
                        case 3:
                            lab = new TocaNota("lab", "http://localhost:5500/assets/Notas/lab.aiff");
                            lab.box.size = 1;
                            lab.box.width = 0.15; 
                            lab.box.height = 0.1; 
                            lab.box.depth = 0.65;
                            lab.box.position.y = 0.06;
                            lab.box.position.z = 0.15;
                            lab.box.position.x = 1.4;
                            notes.set("lab", lab);
                        case 4:
                            sib = new TocaNota("sib", "http://localhost:5500/assets/Notas/sib.aiff");
                            sib.box.size = 1;
                            sib.box.width = 0.15; 
                            sib.box.height = 0.1; 
                            sib.box.depth = 0.65;
                            sib.box.position.y = 0.06;
                            sib.box.position.z = 0.15;
                            sib.box.position.x = 1.73;
                            notes.set("sib", sib);
                        case 5:
                            reb1 = new TocaNota("reb1", "http://localhost:5500/assets/Notas/reb1.aiff");    
                            reb1.box.size = 1;
                            reb1.box.width = 0.15; 
                            reb1.box.height = 0.1; 
                            reb1.box.depth = 0.65;
                            reb1.box.position.y = 0.06;
                            reb1.box.position.z = 0.15;
                            reb1.box.position.x = 2.31;
                            notes.set("reb1", reb1);
                        case 6:
                            sib1 = new TocaNota("sib1", "http://localhost:5500/assets/Notas/sib1.aiff");
                            sib1.box.size = 1;
                            sib1.box.width = 0.15; 
                            sib1.box.height = 0.1; 
                            sib1.box.depth = 0.65;
                            sib1.box.position.y = 0.06;
                            sib1.box.position.z = 0.15;
                            sib1.box.position.x = 2.65;
                            notes.set("sib1", sib1);
                        case 7:
                            solb1 = new TocaNota("solb1", "http://localhost:5500/assets/Notas/solb1.aiff");
                            solb1.box.size = 1;
                            solb1.box.width = 0.15; 
                            solb1.box.height = 0.1; 
                            solb1.box.depth = 0.65;
                            solb1.box.position.y = 0.06;
                            solb1.box.position.z = 0.15;
                            solb1.box.position.x = 3.23;
                            notes.set("solb1", solb1);
                        case 8:
                            lab1 = new TocaNota("lab1", "http://localhost:5500/assets/Notas/lab1.aiff");
                            lab1.box.size = 1;
                            lab1.box.width = 0.15; 
                            lab1.box.height = 0.1; 
                            lab1.box.depth = 0.65;
                            lab1.box.position.y = 0.06;
                            lab1.box.position.z = 0.15;
                            lab1.box.position.x = 3.55;
                            notes.set("lab1", lab1);
                        case 9:
                            sib1 = new TocaNota("sib1", "http://localhost:5500/assets/Notas/sib1.aiff");
                            sib1.box.size = 1;
                            sib1.box.width = 0.15; 
                            sib1.box.height = 0.1; 
                            sib1.box.depth = 0.65;
                            sib1.box.position.y = 0.06;
                            sib1.box.position.z = 0.15;
                            sib1.box.position.x = 3.9;
                            notes.set("sib1", sib1);
                    }
                }
                

                return scene;
            };
            async function managerEvents() {
                scene.onPointerDown = function (evt, pickResults) {
                    if (pickResults.hit) {
                        notes.get(pickResults.pickedMesh.name).play();
                    }
                }
            }
            initFunction = async function() {
                var asyncEngineCreation = async function() {
                    try {
                        return createDefaultEngine();
                    } catch(e) {
                        console.log("the available createEngine function failed. Creating the default engine instead");
                        return createDefaultEngine();
                    }
                }

                engine = await asyncEngineCreation();
                if (!engine) throw 'engine should not be null.';
                scene = createScene();};

            initFunction().then(() => {sceneToRender = scene
                engine.runRenderLoop(function () {
                    if (sceneToRender && sceneToRender.activeCamera) {
                        sceneToRender.render();
                    }
                });
            });

            // Resize
            window.addEventListener("resize", function () {
                engine.resize();
            });

            class TocaNota {
                constructor(noteName, noteUrl) {
                    this.ySlide = new BABYLON.Animation("ySlide", "position.y", 100, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CONSTANT);
                    let keyFrames = [];

                    keyFrames.push({
                        frame: 0,
                        value: 0
                    });

                    keyFrames.push({
                        frame: 5,
                        value: -0.03
                    });

                    keyFrames.push({
                        frame: 10,
                        value: 0
                    });

                    this.ySlide.setKeys(keyFrames);

                    // Load the sound, give it time to load and play it every 3 seconds
                    this.note = new BABYLON.Sound(noteName, noteUrl, scene);
                    this.box = BABYLON.MeshBuilder.CreateBox(noteName, {});
                }

                play() {
                    this.note.play();
                    scene.beginDirectAnimation(this.box, [this.ySlide], 0, 10, true);
                }
            }
        </script>
    </body>
</html>
